jQuery(document).ready(function(A){"use strict";function n(){A("body .tpl-dt-select").each(function(){A(this).has(".select2").length<1&&!A(this).hasClass("no-select2")&&!A(this).parents("#tpl_repeater_bank").length&&(A(this).is(".tpl-dt-font_awesome")?A(this).find("select").select2(i):A(this).find("select").select2(e))})}function t(t){return""!=t.id?t.text:t.text.name}function l(){A("body .tpl-field.tpl-dt-tinymce").not(A("body .tpl-field.tpl-dt-tinymce.tpl-admin-hide")).each(function(){var t=A(this).find("textarea").attr("id");tinyMCE.execCommand("mceAddEditor",!1,t)}),A("body .tpl-field.tpl-dt-tinymce.tpl-admin-hide").each(function(){var t=A(this).find("textarea").attr("id");tinyMCE.execCommand("mceRemoveEditor",!1,t)})}function p(){A(".tpl-repeat").each(function(){A(this).parent().addClass("tpl-repeater")}),void 0!==A.ui.sortable&&A(".tpl-repeater").sortable({handle:".tpl-arranger",update:function(t,e){r(A(this))},start:function(t,e){e.placeholder.height(e.item.height()),e.item.closest(".tpl-repeater").find(".tpl-field.tpl-dt-tinymce textarea").each(function(){var t=A(this).attr("id");tinyMCE.execCommand("mceRemoveEditor",!1,t)})},stop:function(t,e){l()}})}function r(t){var r=window.location.href,d=[];d[0]=0;t.find(".tpl-field").each(function(){var t=parseInt(A(this).attr("data-level")),a=A(this).attr("data-name").split("/");if(0<t)for(var e=0;e<t;e++){for(var i="",s=0;s<=e;s++)i+=a[s],s<e&&(i+="/");d[e]=parseInt(A(this).parents('.tpl-field[data-name="'+i+'"]').last().attr("data-instance"))}var n,l=parseInt(A(this).prev('.tpl-field[data-name="'+A(this).attr("data-name")+'"]').attr("data-instance"));if(n=l,!isNaN(parseFloat(n))&&isFinite(n)?d[t]=l+1:d[t]=0,A(this).attr("data-instance",d[t]),A(this).find(".tpl-header-title-instance").html("(#"+d[t]+")"),0==t)for(var p=1;p<d.length;p++)d[p]=0;A("input, select, textarea",this).each(function(){var t=A(this).attr("id");if(void 0!==t){for(var e=t.split("[")[0],i=0;i<a.length;i++)i<a.length-1||1==a.length?(-1<r.indexOf("post.php")||-1<r.indexOf("post-new.php"))&&0==i?e+="["+d[i]+"]":e+="["+a[i]+"]["+d[i]+"]":A(this).closest(".tpl-field").hasClass("tpl-repeat")?e+="["+a[i]+"]["+d[i]+"]":e+="["+a[i]+"]";A(this).attr("name",e),A(this).attr("id",e),A(this).closest(".tpl-field").prevAll("label").attr("for",e)}})})}function a(t){var e=t.attr("class").split(/\s+/),i="";return A.each(e,function(t,e){0==e.indexOf("tpl-dt-")&&"tpl-dt-combined"!=e&&(i=e)}),i}function d(t){var e="";if(void 0!==t.attr("data-preview-value"))e=t.attr("data-preview-value");else switch(t.prop("tagName").toLowerCase()){case"select":e=t.closest(".tpl-dt-select").is(".tpl-select-preview-key")?t.val():t.closest(".tpl-dt-select").find(".select2-selection__rendered").html();break;case"span":e=t.html();break;case"textarea":e=t.html().replace(/&lt;([\s\S]*?)&gt;/g,"");break;case"img":e=t.attr("src");break;default:e=t.val()}return e}function o(t){t=t.split("/");for(var e="",i=0;i<t.length-1;i++)e+=t[i],i<t.length-2&&(e+="/");return e}function c(){A(".tpl-repeat").each(function(){var n="",e="",l="",p=this;if(e=void 0!==TPL_Admin[A(this).attr("data-name")+"_preview-template"]?A(this).attr("data-name")+"_preview-template":a(A(this))+"_preview-template",A(this).is(".tpl-dt-combined"))if(void 0!==TPL_Admin[e]){var t=(n=TPL_Admin[e]).match(/\[.*?tpl-preview-\w*\]/g);A(".tpl-field",this).each(function(){var a=(l=A(this).attr("data-name")).split("/"),s=this;A.each(t,function(t,e){var i=e.split("/tpl-preview-");i[0]=a[0]+"/"+i[0].substring(1),i[1]=i[1].slice(0,-1),A("*[class*=tpl-preview-]",s).each(function(t){i[0]==l&&A(this).hasClass("tpl-preview-"+i[1])&&(n=-1<o(l).search("/")&&A('[data-name="'+o(l)+'"]').is(".tpl-repeat")&&A(this).closest('[data-name="'+o(l)+'"]').parent().find('[data-name="'+o(l)+'"]').length>parseInt(A(this).closest('[data-name="'+o(l)+'"]').attr("data-instance"))+1&&parseInt(A(s).attr("data-level"))<3&&A(p).is(".tpl-preview-multi")?n.replace(e,d(A(this)))+" / "+e:n.replace(e,d(A(this))))})})}),A.each(t,function(t,e){n=n.replace(e,"")})}else{var i=A(".tpl-field",this).length;A(".tpl-field",this).each(function(t){l=A(this).attr("data-name"),e=a(A(this))+"_preview-template",void 0!==TPL_Admin[e]?(n+=TPL_Admin[e],A("*[class*=tpl-preview-]",this).each(function(t){n=n.replace("[tpl-preview-"+t+"]",d(A(this)))})):A("*[class*=tpl-preview-]",this).each(function(t){n+=d(A(this))}),t<i-1&&(n+=" / ")})}else void 0!==TPL_Admin[e]?(n=TPL_Admin[e],A("*[class*=tpl-preview-]",this).each(function(t){n=n.replace("[tpl-preview-"+t+"]",d(A(this)))})):A("*[class*=tpl-preview-]",this).each(function(t){n+=d(A(this))});A(".tpl-header-title-preview",this).html(n)})}function k(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}function P(){var t,e;return e=null,t=A("body").attr("class").split(" "),A(t).each(function(){"post-type-"!==this.substr(0,10)||(e=(e=this.split("post-type-"))[e.length-1])}),e}function h(){var C=window.location.href;A("body .tpl-field, body .tpl-subitem-repeat-wrapper, body .tpl-meta-option").each(function(){if(-1<C.indexOf("themes.php")||-1<C.indexOf("options-general.php")||-1<C.indexOf("admin.php"))var t=k("page",C),e="tr";if(-1<C.indexOf("post.php")||-1<C.indexOf("post-new.php"))t="",e=".tpl-meta-option";var i=A(this).attr("data-name"),a=A(this).attr("data-connected");if((A(this).hasClass("tpl-subitem-repeat-wrapper")||A(this).hasClass("tpl-meta-option"))&&(i=a),""==t&&(t=A(this).closest(".postbox").attr("id")),void 0!==TPL_Admin.Conditions&&void 0!==TPL_Admin.Conditions[i]){var s,n=Object.keys(TPL_Admin.Conditions[i]).length,l=[];for(s=0;s<n;s++)if(void 0!==TPL_Admin.Conditions[i][s]){var p=TPL_Admin.Conditions[i][s].type,r=TPL_Admin.Conditions[i][s].name,d=TPL_Admin.Conditions[i][s].relation,o=TPL_Admin.Conditions[i][s].value,c="",h="",f=[],m=[],u=[];if("option"==p){if(-1<r.indexOf("/"))if(f=r.split("/"),u=i.split("/"),"_THIS_"==f[0]){for(var v=0;v<u.length-1;v++){m[2*v]=u[v];for(var g="",b=0;b<=v;b++)g+=u[b],b<v&&(g+="/");m[2*v+1]=A(this).closest('.tpl-field[data-name="'+g+'"]').attr("data-instance")}m.push(f[f.length-1])}else m=f;else m[0]=r,m[1]=0;c=-1<C.indexOf("post.php")||-1<C.indexOf("post-new.php")?"#"+m[0]:"#"+t;for(var w=0;w<m.length;w++)-1<C.indexOf("post.php")||-1<C.indexOf("post-new.php")?0<w&&(c+="\\["+m[w]+"\\]"):c+="\\["+m[w]+"\\]";h=A(c).val()}if("post"==p&&("type"==r&&(h=P()),"id"==r&&(h=k("post",C))),"page"==p&&"template"==r&&(h=A("#page_template").val()),"taxonomy"==p)if("post_format"==r)A("#post-formats-select input").each(function(){A(this).is(":checked")&&(h=A(this).attr("id").replace("post-format-",""))});else{h=[];var y=0;A("#"+r+"checklist li").each(function(){y=A(this).attr("id").replace(r+"-",""),A("input",this).is(":checked")&&h.push(y)})}switch(d){case"=":A.isArray(h)?-1<A.inArray(o,h)?l.push(!0):l.push(!1):h==o?l.push(!0):l.push(!1);break;case"!=":A.isArray(h)?A.inArray(o,h)<0?l.push(!0):l.push(!1):h!=o?l.push(!0):l.push(!1);break;case"<":h<o?l.push(!0):l.push(!1);break;case">":o<h?l.push(!0):l.push(!1)}}var _=!1,x="and";if(void 0!==TPL_Admin.Conditions[i].logic)x=TPL_Admin.Conditions[i].logic;"and"==x&&A.inArray(!1,l)<0&&(_=!0),"or"==x&&-1<A.inArray(!0,l)&&(_=!0),a=a.replace("/","/"),1==_?void 0!==a&&(A(this).parent().parent().parent().find('[data-connected="'+a+'"]').removeClass("tpl-admin-hide"),"tr"==e&&"0"==A(this).attr("data-level")?(A(this).closest(e).next(e).has(".tpl-optiondesc").removeClass("tpl-admin-hide"),A(this).closest(e).removeClass("tpl-admin-hide")):A(this).closest(e).next("p.tpl-optiondesc").removeClass("tpl-admin-hide"),A(this).find("input, select, textarea").each(function(){A(this).attr("name",A(this).attr("id"))})):void 0!==a&&(A(this).parent().parent().parent().find('[data-connected="'+a+'"]').addClass("tpl-admin-hide"),"tr"==e&&"0"==A(this).attr("data-level")?(A(this).closest(e).next(e).has(".tpl-optiondesc").addClass("tpl-admin-hide"),A(this).closest(e).addClass("tpl-admin-hide")):A(this).closest(e).next("p.tpl-optiondesc").addClass("tpl-admin-hide"),A(this).find("input, select, textarea").removeAttr("name"),A(this).closest(e).find(".tpl-field.tpl-dt-tinymce.tpl-admin-hide textarea").each(function(){var t=A(this).attr("id");tinymce.execCommand("mceRemoveEditor",!1,t)}))}}),A(".postbox").each(function(){var t=[];A(".tpl-meta-option",this).each(function(){A(this).hasClass("tpl-admin-hide")?t.push(!0):t.push(!1)}),-1<A.inArray(!0,t)&&A.inArray(!1,t)<0?A(this).addClass("tpl-admin-hide"):A(this).removeClass("tpl-admin-hide")})}var s;TPL_Admin.basic_select2_settings={escapeMarkup:function(t){return t},width:"100%"};var e=A.extend({minimumResultsForSearch:10},TPL_Admin.basic_select2_settings),i=A.extend({templateSelection:t,templateResult:t,formatSelection:t,formatResult:t,minimumResultsForSearch:10},TPL_Admin.basic_select2_settings);p(),A("#wp-dummy_editor-wrap").remove(),A("body").on("click",".tpl-uploader .button, .tpl-uploader .tpl-uploaded-image, .tpl-img-placeholder",function(t){t.preventDefault();var e=A(this).parent().find(".tpl-uploaded-image"),i=e.closest(".tpl-field");(s=wp.media.frames.file_frame=wp.media({title:TPL_Admin.uploader_title,button:{text:TPL_Admin.uploader_button},multiple:!1})).on("select",function(){var t=s.state().get("selection").first().toJSON();void 0!==t.sizes.thumbnail?e.attr("src",t.sizes.thumbnail.url):e.attr("src",t.sizes.full.url),e.show(),i.find(".tpl-img_id").val(t.id).trigger("change"),i.find(".tpl-img-placeholder").hide(),i.find(".tpl-closer").show(),c()}),s.open()}),A("body").on("click",".tpl-uploader .tpl-closer",function(){var t=A(this).parent().find(".tpl-uploaded-image"),e=t.closest(".tpl-field");t.attr("src",""),e.find(".tpl-img-placeholder").show(),e.find(".tpl-uploaded-image").hide(),A(this).closest(".tpl-field").find(".tpl-img_id").val("").trigger("change"),A(this).hide(),c()});var f={width:258,change:function(t,e){A(this).val(A(this).wpColorPicker("color")),h(),c()}};if(A("body .tpl-color-field").each(function(){A(this).wpColorPicker(f)}),n(),A(".tpl-dt-font_awesome select").change(function(){var t=A(this).select2("data")[0].text.match(/ data-type="([^"]*)"/);A(this).closest(".tpl-field").find(".tpl-preview-3").val(t[1]),A(this).closest(".tpl-field").find(".tpl-preview-3").attr(t[1])}),A("body").on("click",".tpl-editor-switch-buttons-wrap button",function(t){t.preventDefault();var e=A(this).closest(".tpl-field.tpl-dt-tinymce").find("textarea").attr("id");if(A(this).hasClass("tpl-editor-visual-button")){tinyMCE.execCommand("mceAddEditor",!1,e);e=A(this).closest(".tpl-field.tpl-dt-tinymce").find("textarea").css("visibility","hidden")}if(A(this).hasClass("tpl-editor-text-button")){tinyMCE.execCommand("mceRemoveEditor",!1,e);e=A(this).closest(".tpl-field.tpl-dt-tinymce").find("textarea").css("visibility","visible")}}),void 0!==A.datepicker&&A("body .tpl-field.tpl-dt-date input.tpl-date-field").datepicker({dateFormat:"yy-mm-dd",firstDay:TPL_Admin.date_starts_with}),A("body").on("click",".tpl-field.tpl-dt-boolean label",function(){var t=parseInt(A("input",this).val());if(1==t)var e=0;if(0==t||isNaN(t))e=1;A("input",this).val(e).trigger("change"),A(this).attr("class","checked-"+e)}),A("body").on("click","button.tpl-repeat-add",function(t){t.preventDefault();var e,i,a,s=function(t){var e=window.location.href;if(-1<e.indexOf("themes.php")||-1<e.indexOf("options-general.php")||-1<e.indexOf("admin.php"))if(t.parent().prev().hasClass("tpl-subitem-repeat-wrapper"))var i=t.parent().prev(".tpl-subitem-repeat-wrapper");else i=t.closest("tr").prev().find("td");(-1<e.indexOf("post.php")||-1<e.indexOf("post-new.php"))&&(i=t.parent().prev().hasClass("tpl-subitem-repeat-wrapper")?t.parent().prev(".tpl-subitem-repeat-wrapper"):t.parent().prev(".tpl-meta-option-wrapper"));return i}(A(this));e=s,i=A(this).attr("data-for"),a=A("#tpl_repeater_bank .tpl-field[data-name='"+i+"']").clone(),e.append(a),r(e),p(),h(),0<A(".tpl-dt-color").length&&A("body .tpl-color-field").wpColorPicker(f),n(),void 0!==A.datepicker&&A("body .tpl-field.tpl-dt-date input.tpl-date-field").datepicker({dateFormat:"yy-mm-dd",firstDay:TPL_Admin.date_starts_with}),l(),c()}),A("body").on("click",".tpl-remover",function(){var t,e;t=A(this),e=A(t).closest(".tpl-repeater"),1==confirm(TPL_Admin.remover_confirm_text)&&(A(t).closest(".tpl-field").remove(),r(e))}),A("body").on("click",".tpl-toggle-close",function(){A(this).closest(".tpl-repeat").children(".tpl-field-inner").addClass("tpl-admin-hide"),A(this).closest(".tpl-repeat-header").addClass("tpl-repeat-header-closed"),A(this).attr("title",TPL_Admin.Repeat_Maximize),A(this).removeClass("tpl-toggle-close"),A(this).addClass("tpl-toggle-open")}),A("body").on("click",".tpl-toggle-open",function(){A(this).closest(".tpl-repeat").children(".tpl-field-inner").removeClass("tpl-admin-hide"),A(this).closest(".tpl-repeat-header").removeClass("tpl-repeat-header-closed"),A(this).attr("title",TPL_Admin.Repeat_Minimize),A(this).addClass("tpl-toggle-close"),A(this).removeClass("tpl-toggle-open")}),A(window).load(function(){c()}),void 0!==A.ui.tabs&&(A("#tpl-settings-tabs").tabs(),"undefined"!=typeof Storage&&0!=A("#tpl-settings-tabs").length)){var m=A("#tpl-settings-tabs").attr("data-store"),u=sessionStorage.getItem(m);void 0!==u&&A("#tpl-settings-tabs").tabs("option","active",u),A("#tpl-settings-tabs .nav-tab").click(function(){var t=A("#tpl-settings-tabs").attr("data-store"),e=A("#tpl-settings-tabs").tabs("option","active");sessionStorage.setItem(t,e)})}h(),l(),A("body").on("change","select, input, textarea",function(){h(),c()}),A("body").on("keyup","input, textarea",function(){A(this).val().length<2&&h()})});