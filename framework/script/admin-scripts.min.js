jQuery(document).ready(function(t){"use strict";function e(){t("#wpbody .tpl-dt-select").each(function(){t(this).has(".select2").length<1&&(t(this).not(".tpl-dt-font_awesome").find("select").select2(w),t(this).is(".tpl-dt-font_awesome")&&t(this).find("select").select2(b))})}function i(t){return'<i class="fa fa-lg fa-fw fa-'+t.id+'"></i> '+t.text}function a(){t("#wpbody .tpl-field.tpl-dt-tinymce").not(t("#wpbody .tpl-field.tpl-dt-tinymce.tpl-admin-hide")).each(function(){var e=t(this).find("textarea").attr("id");tinyMCE.execCommand("mceAddEditor",!1,e)}),t("#wpbody .tpl-field.tpl-dt-tinymce.tpl-admin-hide").each(function(){var e=t(this).find("textarea").attr("id");tinyMCE.execCommand("mceRemoveEditor",!1,e)})}function s(t){var e=window.location.href;if(e.indexOf("themes.php")>-1||e.indexOf("options-general.php")>-1)if(t.parent().prev().hasClass("tpl-subitem-repeat-wrapper"))i=t.parent().prev(".tpl-subitem-repeat-wrapper");else i=t.closest("tr").prev().find("td");if(e.indexOf("post.php")>-1||e.indexOf("post-new.php")>-1)if(t.parent().prev().hasClass("tpl-subitem-repeat-wrapper"))i=t.parent().prev(".tpl-subitem-repeat-wrapper");else var i=t.parent().prev(".tpl-meta-option-wrapper");return i}function n(i,s){var n=t("#tpl_repeater_bank .tpl-field[data-name='"+s+"']").clone();i.append(n),r(i),p(),v(),t(".tpl-dt-color").length>0&&t("#wpbody .tpl-color-field").wpColorPicker(_),e(),void 0!==t.datepicker&&t("#wpbody .tpl-field.tpl-dt-date input.tpl-date-field").datepicker({dateFormat:"yy-mm-dd",firstDay:TPL_Admin.date_starts_with}),a(),h()}function l(e){var i=t(e).closest(".tpl-repeater");1==confirm(TPL_Admin.remover_confirm_text)&&(t(e).closest(".tpl-field").remove(),r(i))}function p(){t(".tpl-repeat").each(function(){t(this).parent().addClass("tpl-repeater")}),void 0!==t.ui.sortable&&t(".tpl-repeater").sortable({handle:".tpl-arranger",update:function(e,i){r(t(this))},start:function(e,i){i.placeholder.height(i.item.height()),i.item.closest(".tpl-repeater").find(".tpl-field.tpl-dt-tinymce textarea").each(function(){var e=t(this).attr("id");tinyMCE.execCommand("mceRemoveEditor",!1,e)})},stop:function(t,e){a()}})}function r(e){var i=window.location.href,a=[];a[0]=0;e.find(".tpl-field").each(function(){var e=parseInt(t(this).attr("data-level")),s=t(this).attr("data-name").split("/");if(e>0)for(var n=0;n<e;n++){for(var l="",p=0;p<=n;p++)l+=s[p],p<n&&(l+="/");a[n]=parseInt(t(this).parents('.tpl-field[data-name="'+l+'"]').last().attr("data-instance"))}var r=parseInt(t(this).prev('.tpl-field[data-name="'+t(this).attr("data-name")+'"]').attr("data-instance"));if(u(r)?a[e]=r+1:a[e]=0,t(this).attr("data-instance",a[e]),t(this).find(".tpl-header-title-instance").html("(#"+a[e]+")"),0==e)for(var o=1;o<a.length;o++)a[o]=0;t("input, select, textarea",this).each(function(){var e=t(this).attr("id");if(void 0!==e){for(var n=e.split("[")[0],l=0;l<s.length;l++)l<s.length-1||1==s.length?(i.indexOf("post.php")>-1||i.indexOf("post-new.php")>-1)&&0==l?n+="["+a[l]+"]":n+="["+s[l]+"]["+a[l]+"]":t(this).closest(".tpl-field").hasClass("tpl-repeat")?n+="["+s[l]+"]["+a[l]+"]":n+="["+s[l]+"]";t(this).attr("name",n),t(this).attr("id",n),t(this).closest(".tpl-field").prevAll("label").attr("for",n)}})})}function o(e){var i=e.attr("class").split(/\s+/),a="";return t.each(i,function(t,e){0==e.indexOf("tpl-dt-")&&"tpl-dt-combined"!=e&&(a=e)}),a}function d(t){var e="";if(void 0!==t.attr("data-preview-value"))e=t.attr("data-preview-value");else switch(t.prop("tagName").toLowerCase()){case"select":e=t.closest(".tpl-dt-select").is(".tpl-select-preview-key")?t.val():t.closest(".tpl-dt-select").find(".select2-selection__rendered").html();break;case"span":e=t.html();break;case"textarea":e=t.html().replace(/&lt;([\s\S]*?)&gt;/g,"");break;case"img":e=t.attr("src");break;default:e=t.val()}return e}function c(t){t=t.split("/");for(var e="",i=0;i<t.length-1;i++)e+=t[i],i<t.length-2&&(e+="/");return e}function h(){t(".tpl-repeat").each(function(){var e="",i="",a="",s=this;if(i=void 0!==TPL_Admin[t(this).attr("data-name")+"_preview-template"]?t(this).attr("data-name")+"_preview-template":o(t(this))+"_preview-template",t(this).is(".tpl-dt-combined"))if(void 0!==TPL_Admin[i]){var n=(e=TPL_Admin[i]).match(/\[.*?tpl-preview-\w*\]/g);t(".tpl-field",this).each(function(){var i=(a=t(this).attr("data-name")).split("/"),l=this;t.each(n,function(n,p){var r=p.split("/tpl-preview-");r[0]=i[0]+"/"+r[0].substring(1),r[1]=r[1].slice(0,-1),t("*[class*=tpl-preview-]",l).each(function(i){r[0]==a&&t(this).hasClass("tpl-preview-"+r[1])&&(e=c(a).search("/")>-1&&t('[data-name="'+c(a)+'"]').is(".tpl-repeat")&&t(this).closest('[data-name="'+c(a)+'"]').parent().find('[data-name="'+c(a)+'"]').length>parseInt(t(this).closest('[data-name="'+c(a)+'"]').attr("data-instance"))+1&&parseInt(t(l).attr("data-level"))<3&&t(s).is(".tpl-preview-multi")?e.replace(p,d(t(this)))+" / "+p:e.replace(p,d(t(this))))})})}),t.each(n,function(t,i){e=e.replace(i,"")})}else{var l=t(".tpl-field",this).length;t(".tpl-field",this).each(function(s){a=t(this).attr("data-name"),i=o(t(this))+"_preview-template",void 0!==TPL_Admin[i]?(e+=TPL_Admin[i],t("*[class*=tpl-preview-]",this).each(function(i){e=e.replace("[tpl-preview-"+i+"]",d(t(this)))})):t("*[class*=tpl-preview-]",this).each(function(i){e+=d(t(this))}),s<l-1&&(e+=" / ")})}else void 0!==TPL_Admin[i]?(e=TPL_Admin[i],t("*[class*=tpl-preview-]",this).each(function(i){e=e.replace("[tpl-preview-"+i+"]",d(t(this)))})):t("*[class*=tpl-preview-]",this).each(function(i){e+=d(t(this))});t(".tpl-header-title-preview",this).html(e)})}function f(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}function m(){var e,i;return i=null,e=t("body").attr("class").split(" "),t(e).each(function(){if("post-type-"===this.substr(0,10))return i=this.split("post-type-"),void(i=i[i.length-1])}),i}function u(t){return!isNaN(parseFloat(t))&&isFinite(t)}function v(){var e=window.location.href;t("#wpbody .tpl-field, #wpbody .tpl-subitem-repeat-wrapper, #wpbody .tpl-meta-option").each(function(){if(e.indexOf("themes.php")>-1||e.indexOf("options-general.php")>-1)var i=f("page",e),a="tr";if(e.indexOf("post.php")>-1||e.indexOf("post-new.php")>-1)var i="",a=".tpl-meta-option";var s=t(this).attr("data-name"),n=t(this).attr("data-connected");if((t(this).hasClass("tpl-subitem-repeat-wrapper")||t(this).hasClass("tpl-meta-option"))&&(s=n),""==i&&(i=t(this).closest(".postbox").attr("id")),void 0!==TPL_Admin.Conditions&&void 0!==TPL_Admin.Conditions[s]){var l,p=Object.keys(TPL_Admin.Conditions[s]).length,r=[];for(l=0;l<p;l++)if(void 0!==TPL_Admin.Conditions[s][l]){var o=TPL_Admin.Conditions[s][l].type,d=TPL_Admin.Conditions[s][l].name,c=TPL_Admin.Conditions[s][l].relation,h=TPL_Admin.Conditions[s][l].value,u="",v="",g=[],w=[],b=[];if("option"==o){if(d.indexOf("/")>-1)if(g=d.split("/"),b=s.split("/"),"_THIS_"==g[0]){for(var _=0;_<b.length-1;_++){w[2*_]=b[_];for(var y="",C=0;C<=_;C++)y+=b[C],C<_&&(y+="/");w[2*_+1]=t(this).closest('.tpl-field[data-name="'+y+'"]').attr("data-instance")}w.push(g[g.length-1])}else w=g;else w[0]=d,w[1]=0;u="#"+i,(e.indexOf("post.php")>-1||e.indexOf("post-new.php")>-1)&&(u+="_"+w[0]);for(var x=0;x<w.length;x++)e.indexOf("post.php")>-1||e.indexOf("post-new.php")>-1?x>0&&(u+="\\["+w[x]+"\\]"):u+="\\["+w[x]+"\\]";v=t(u).val()}if("post"==o&&("type"==d&&(v=m()),"id"==d&&(v=f("post",e))),"page"==o&&"template"==d&&(v=t("#page_template").val()),"taxonomy"==o)if("post_format"==d)t("#post-formats-select input").each(function(){t(this).is(":checked")&&(v=t(this).attr("id").replace("post-format-",""))});else{var v=[],A=0;t("#"+d+"checklist li").each(function(){A=t(this).attr("id").replace(d+"-",""),t("input",this).is(":checked")&&v.push(A)})}switch(c){case"=":t.isArray(v)?t.inArray(h,v)>-1?r.push(!0):r.push(!1):v==h?r.push(!0):r.push(!1);break;case"!=":t.isArray(v)?t.inArray(h,v)<0?r.push(!0):r.push(!1):v!=h?r.push(!0):r.push(!1);break;case"<":v<h?r.push(!0):r.push(!1);break;case">":v>h?r.push(!0):r.push(!1)}}var k=!1,P="and";if(void 0!==TPL_Admin.Conditions[s].logic)P=TPL_Admin.Conditions[s].logic;"and"==P&&t.inArray(!1,r)<0&&(k=!0),"or"==P&&t.inArray(!0,r)>-1&&(k=!0),n=n.replace("/","/"),1==k?void 0!==n&&(t(this).parent().parent().parent().find('[data-connected="'+n+'"]').removeClass("tpl-admin-hide"),"tr"==a&&"0"==t(this).attr("data-level")?(t(this).closest(a).next(a).has(".tpl-optiondesc").removeClass("tpl-admin-hide"),t(this).closest(a).removeClass("tpl-admin-hide")):t(this).closest(a).next("p.tpl-optiondesc").removeClass("tpl-admin-hide"),t(this).find("input, select, textarea").each(function(){t(this).attr("name",t(this).attr("id"))})):void 0!==n&&(t(this).parent().parent().parent().find('[data-connected="'+n+'"]').addClass("tpl-admin-hide"),"tr"==a&&"0"==t(this).attr("data-level")?(t(this).closest(a).next(a).has(".tpl-optiondesc").addClass("tpl-admin-hide"),t(this).closest(a).addClass("tpl-admin-hide")):t(this).closest(a).next("p.tpl-optiondesc").addClass("tpl-admin-hide"),t(this).find("input, select, textarea").removeAttr("name"),t(this).closest(a).find(".tpl-field.tpl-dt-tinymce.tpl-admin-hide textarea").each(function(){var e=t(this).attr("id");tinymce.execCommand("mceRemoveEditor",!1,e)}))}}),t(".postbox").each(function(){var e=[];t(".tpl-meta-option",this).each(function(){t(this).hasClass("tpl-admin-hide")?e.push(!0):e.push(!1)}),t.inArray(!0,e)>-1&&t.inArray(!1,e)<0?t(this).addClass("tpl-admin-hide"):t(this).removeClass("tpl-admin-hide")})}var g;TPL_Admin.basic_select2_settings={escapeMarkup:function(t){return t},width:"100%"};var w=t.extend({minimumResultsForSearch:10},TPL_Admin.basic_select2_settings),b=t.extend({templateSelection:i,templateResult:i,formatSelection:i,formatResult:i,minimumResultsForSearch:10},TPL_Admin.basic_select2_settings);p(),t("#wp-dummy_editor-wrap").remove(),t("body").on("click",".tpl-uploader .button, .tpl-uploader .tpl-uploaded-image, .tpl-img-placeholder",function(e){e.preventDefault();var i=t(this).parent().find(".tpl-uploaded-image"),a=i.closest(".tpl-field");(g=wp.media.frames.file_frame=wp.media({title:TPL_Admin.uploader_title,button:{text:TPL_Admin.uploader_button},multiple:!1})).on("select",function(){var t=g.state().get("selection").first().toJSON();void 0!==t.sizes.thumbnail?i.attr("src",t.sizes.thumbnail.url):i.attr("src",t.sizes.full.url),i.show(),a.find(".tpl-img_id").val(t.id).trigger("change"),a.find(".tpl-img-placeholder").hide(),a.find(".tpl-closer").show(),h()}),g.open()}),t("body").on("click",".tpl-uploader .tpl-closer",function(){var e=t(this).parent().find(".tpl-uploaded-image"),i=e.closest(".tpl-field");e.attr("src",""),i.find(".tpl-img-placeholder").show(),i.find(".tpl-uploaded-image").hide(),t(this).closest(".tpl-field").find(".tpl-img_id").val("").trigger("change"),t(this).hide(),h()});var _={width:258,change:function(e,i){t(this).val(t(this).wpColorPicker("color")),v(),h()}};if(t("#wpbody .tpl-color-field").each(function(){t(this).wpColorPicker(_)}),e(),void 0!==t.datepicker&&t("#wpbody .tpl-field.tpl-dt-date input.tpl-date-field").datepicker({dateFormat:"yy-mm-dd",firstDay:TPL_Admin.date_starts_with}),t("#wpbody").on("click",".tpl-field.tpl-dt-boolean label",function(){var e=parseInt(t("input",this).val());if(1==e)i=0;if(0==e||isNaN(e))var i=1;t("input",this).val(i).trigger("change"),t(this).attr("class","checked-"+i)}),t("body").on("click","button.tpl-repeat-add",function(e){e.preventDefault(),n(s(t(this)),t(this).attr("data-for"))}),t("body").on("click",".tpl-remover",function(){l(t(this))}),t("body").on("click",".tpl-toggle-close",function(){t(this).closest(".tpl-repeat").children(".tpl-field-inner").addClass("tpl-admin-hide"),t(this).closest(".tpl-repeat-header").addClass("tpl-repeat-header-closed"),t(this).attr("title",TPL_Admin.Repeat_Maximize),t(this).removeClass("tpl-toggle-close"),t(this).addClass("tpl-toggle-open")}),t("body").on("click",".tpl-toggle-open",function(){t(this).closest(".tpl-repeat").children(".tpl-field-inner").removeClass("tpl-admin-hide"),t(this).closest(".tpl-repeat-header").removeClass("tpl-repeat-header-closed"),t(this).attr("title",TPL_Admin.Repeat_Minimize),t(this).addClass("tpl-toggle-close"),t(this).removeClass("tpl-toggle-open")}),t(window).load(function(){h()}),t("#tpl-settings-tabs").tabs(),"undefined"!=typeof Storage){var y=t("#tpl-settings-tabs").attr("data-store"),C=sessionStorage.getItem(y);void 0!==C&&t("#tpl-settings-tabs").tabs("option","active",C)}t("#tpl-settings-tabs .nav-tab").click(function(){if("undefined"!=typeof Storage){var e=t("#tpl-settings-tabs").attr("data-store"),i=t("#tpl-settings-tabs").tabs("option","active");sessionStorage.setItem(e,i)}}),v(),a(),t("body").on("change","select, input, textarea",function(){v(),h()}),t("body").on("keyup","input, textarea",function(){t(this).val().length<2&&v()})});