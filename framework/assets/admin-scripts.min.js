jQuery(document).ready((function(t){"use strict";var e;TPL_Admin.basic_select2_settings={escapeMarkup:function(t){return t},width:"100%"};var i=t.extend({minimumResultsForSearch:10},TPL_Admin.basic_select2_settings),a=t.extend({templateSelection:l,templateResult:l,formatSelection:l,formatResult:l,minimumResultsForSearch:10},TPL_Admin.basic_select2_settings);r(),t("#wp-dummy_editor-wrap").remove(),t("body").on("click",".tpl-uploader .button, .tpl-uploader .tpl-uploaded-image, .tpl-img-placeholder",(function(i){i.preventDefault();var a=t(this).parent().find(".tpl-uploaded-image"),s=a.closest(".tpl-field");(e=wp.media.frames.file_frame=wp.media({title:TPL_Admin.uploader_title,button:{text:TPL_Admin.uploader_button},multiple:!1})).on("select",(function(){var t=e.state().get("selection").first().toJSON();void 0!==t.sizes.thumbnail?a.attr("src",t.sizes.thumbnail.url):a.attr("src",t.sizes.full.url),a.show(),s.find(".tpl-img_id").val(t.id).trigger("change"),s.find(".tpl-img-placeholder").hide(),s.find(".tpl-closer").show(),f()})),e.open()})),t("body").on("click",".tpl-uploader .tpl-closer",(function(){var e=t(this).parent().find(".tpl-uploaded-image"),i=e.closest(".tpl-field");e.attr("src",""),i.find(".tpl-img-placeholder").show(),i.find(".tpl-uploaded-image").hide(),t(this).closest(".tpl-field").find(".tpl-img_id").val("").trigger("change"),t(this).hide(),f()}));var s={width:258,change:function(e,i){t(this).val(t(this).wpColorPicker("color")),_(),f()}};function n(){t("body .tpl-dt-select").each((function(){t(this).has(".select2").length<1&&!t(this).hasClass("no-select2")&&!t(this).parents("#tpl_repeater_bank").length&&(t(this).is(".tpl-dt-font_awesome")?t(this).find("select").select2(a):t(this).find("select").select2(i))}))}function l(t){return t.text}function o(){t("body .tpl-field.tpl-dt-tinymce").not(t("body .tpl-field.tpl-dt-tinymce.tpl-admin-hide")).each((function(){var e=t(this).find("textarea").attr("id");tinyMCE.execCommand("mceAddEditor",!1,e)})),t("body .tpl-field.tpl-dt-tinymce.tpl-admin-hide").each((function(){var e=t(this).find("textarea").attr("id");tinyMCE.execCommand("mceRemoveEditor",!1,e)}))}function r(){t(".tpl-repeat").each((function(){t(this).parent().addClass("tpl-repeater")||t(this).parent().addClass("tpl-repeater")})),void 0!==t.ui.sortable&&t(".tpl-repeater").sortable({handle:".tpl-arranger",items:".tpl-repeat",update:function(e,i){d(t(this))},start:function(e,i){i.placeholder.height(i.item.height()),i.item.closest(".tpl-repeater").find(".tpl-field.tpl-dt-tinymce textarea").each((function(){var e=t(this).attr("id");tinyMCE.execCommand("mceRemoveEditor",!1,e)}))},stop:function(t,e){o()}})}function d(e){var i=[];i[0]=0;e.find(".tpl-field").each((function(){var e=parseInt(t(this).attr("data-level")),a=t(this).attr("data-name").split("/");if(e>0)for(var s=0;s<e;s++){for(var n="",l=0;l<=s;l++)n+=a[l],l<s&&(n+="/");i[s]=parseInt(t(this).parents('.tpl-field[data-name="'+n+'"]').last().attr("data-instance"))}var o,r=parseInt(t(this).prev('.tpl-field[data-name="'+t(this).attr("data-name")+'"]').attr("data-instance"));o=r,!isNaN(parseFloat(o))&&isFinite(o)?i[e]=r+1:i[e]=0,t(this).attr("data-instance",i[e]);var d=t(this).closest(".tpl-dt-combined"),p=d.attr("data-instance");if(t(".tpl-subitem, .tpl-subitem-wrapper",d).attr("data-instance",p),t(this).find(".tpl-header-title-instance").html("(#"+i[e]+")"),0==e)for(var c=1;c<i.length;c++)i[c]=0;t("input, select, textarea",this).each((function(){if(b.is_section_primary())var e=t(this).closest(".tpl_settings_page_wrap").attr("data-name");else e=a[0];if(void 0!==e){for(var s=e,n=0;n<a.length;n++)n<a.length-1||1==a.length?b.is_section_primary()||0!=n?s+="["+a[n]+"]["+i[n]+"]":s+="["+i[n]+"]":t(this).closest(".tpl-field").hasClass("tpl-repeat")?s+="["+a[n]+"]["+i[n]+"]":s+="["+a[n]+"]";t(this).attr("name",s),t(this).attr("id",s),t(this).closest(".tpl-field").prevAll("label").attr("for",s)}}))}))}function p(t){return"tpl-dt-"+t.attr("data-type")}function c(t){var e="";if(void 0!==t.attr("data-preview-value"))e=t.attr("data-preview-value");else switch(t.prop("tagName").toLowerCase()){case"select":e=t.closest(".tpl-dt-select").is(".tpl-select-preview-key")?t.val():t.closest(".tpl-dt-select").find(".select2-selection__rendered").html();break;case"span":e=t.html();break;case"textarea":var i=t.val(),a=document.createElement("div");a.innerHTML=i,e=a.textContent||a.innerText||"";break;case"img":e=t.attr("src");break;default:e=t.val()}return e}function h(t){t=t.split("/");for(var e="",i=0;i<t.length-1;i++)e+=t[i],i<t.length-2&&(e+="/");return e}function f(){t(".tpl-repeat").each((function(){var e="",i="",a="",s=this;if(i=void 0!==TPL_Admin[t(this).attr("data-name")+"_preview-template"]?t(this).attr("data-name")+"_preview-template":p(t(this))+"_preview-template",t(this).is(".tpl-dt-combined"))if(void 0!==TPL_Admin[i]){var n=(e=TPL_Admin[i]).match(/\[.*?tpl-preview-\w*\]/g);t(".tpl-field",this).each((function(){var i=(a=t(this).attr("data-name")).split("/"),l=this;t.each(n,(function(n,o){var r=o.split("/tpl-preview-");r[0]=i[0]+"/"+r[0].substring(1),r[1]=r[1].slice(0,-1),t("*[data-preview]",l).each((function(){r[0]==a&&t(this).attr("data-preview")==r[1]&&(e=h(a).search("/")>-1&&t('[data-name="'+h(a)+'"]').is(".tpl-repeat")&&t(this).closest('[data-name="'+h(a)+'"]').parent().find('[data-name="'+h(a)+'"]').length>parseInt(t(this).closest('[data-name="'+h(a)+'"]').attr("data-instance"))+1&&parseInt(t(l).attr("data-level"))<3&&t(s).is(".tpl-preview-multi")?e.replace(o,c(t(this)))+" / "+o:e.replace(o,c(t(this))))}))}))})),t.each(n,(function(t,i){e=e.replace(i,"")}))}else{var l=t(".tpl-field",this).length;t(".tpl-field",this).each((function(s){a=t(this).attr("data-name"),i=p(t(this))+"_preview-template",void 0!==TPL_Admin[i]?(e+=TPL_Admin[i],t("*[data-preview]",this).each((function(){var i=t(this).attr("data-preview");e=e.replace("[tpl-preview-"+i+"]",c(t(this)))}))):t("*[data-preview]",this).each((function(){e+=c(t(this))})),s<l-1&&(e+=" / ")}))}else void 0!==TPL_Admin[i]?(e=TPL_Admin[i],t("*[data-preview]",this).each((function(){var i=t(this).attr("data-preview");e.indexOf("[tpl-preview-"+i+"]")>-1&&(e=e.replace("[tpl-preview-"+i+"]",c(t(this))))}))):t("*[data-preview]",this).each((function(){t(this).attr("data-preview");e+=c(t(this))}));t(".tpl-header-title-preview",this).html(e)}))}if(t(".tpl-color-field").focus((function(){t(this).wpColorPicker(s)})),t(".tpl-color-field").each((function(){t(this).focus()})),t(".handlediv").click((function(){t(this).closest(".postbox").not("closed").find(".tpl-color-field").wpColorPicker(s)})),n(),t("body").on("change",".tpl-dt-font_awesome select",(function(){var e=t(this).select2("data")[0].text.match(/ data-type="([^"]*)"/);t(this).closest(".tpl-field").find("[data-preview=3]").html(e[1])})),t("body").on("change",".tpl-dt-post select",(function(){if(""==t(this).val())t(this).closest(".tpl-datatype-container").find(".tpl-edit-icon").addClass("tpl-admin-hide"),t(this).closest(".tpl-datatype-container").find(".tpl-new-icon").removeClass("tpl-admin-hide");else{var e=t(this).closest(".tpl-datatype-container").attr("data-edit-url-template").replace("%d",t(this).val());t(this).closest(".tpl-datatype-container").find(".tpl-new-icon").addClass("tpl-admin-hide"),t(this).closest(".tpl-datatype-container").find(".tpl-edit-icon").attr("href",e).removeClass("tpl-admin-hide")}})),t("body").on("click",".tpl-dt-post .tpl-template-add-icon",(function(e){e.preventDefault();var i=t(this).closest(".tpl-field").attr("data-name"),a=t(this).closest(".tpl-field").find("select");t.ajax({type:"post",dataType:"json",url:TPL_Admin.ajaxurl,data:{action:"tpl_create_post",option_name:i,_wpnonce:TPL_Admin.ajax_nonce},success:function(t){if(1==t.success){var e={id:t.post_id,text:t.select_label},i=new Option(e.text,e.id,!1,!1);a.append(i).trigger("change"),a.val(e.id).trigger("change")}}})})),t("body").on("click",".tpl-dt-select .tpl-refresh-icon",(function(e){e.preventDefault();var i=t(this).closest(".tpl-field").attr("data-name"),a=t(this).attr("data-refresh"),s=t(this).closest(".tpl-field").find("select"),n=t(this);n.addClass("fa-spin"),t.ajax({type:"post",dataType:"json",url:TPL_Admin.ajaxurl,data:{action:a,option_name:i,_wpnonce:TPL_Admin.ajax_nonce},success:function(e){t.each(e,(function(t,e){if(!s.find('option[value="'+t+'"]').length){var i=new Option(e,t,!1,!1);s.append(i)}}))},complete:function(){n.removeClass("fa-spin")}})})),t("body").on("click",".tpl-editor-switch-buttons-wrap button",(function(e){e.preventDefault();var i=t(this).closest(".tpl-field.tpl-dt-tinymce").find("textarea").attr("id");if(t(this).hasClass("tpl-editor-visual-button")){tinyMCE.execCommand("mceAddEditor",!1,i);i=t(this).closest(".tpl-field.tpl-dt-tinymce").find("textarea").css("visibility","hidden")}if(t(this).hasClass("tpl-editor-text-button")){tinyMCE.execCommand("mceRemoveEditor",!1,i);i=t(this).closest(".tpl-field.tpl-dt-tinymce").find("textarea").css("visibility","visible")}})),void 0!==t.datepicker&&t("body").on("focus",".tpl-field.tpl-dt-date input.tpl-date-field",(function(){t(this).datepicker({dateFormat:"yy-mm-dd",firstDay:TPL_Admin.date_starts_with})})),t("body").on("click",".tpl-field.tpl-dt-boolean label",(function(){var e=parseInt(t("input",this).val());if(1==e)var i=0;if(0==e||isNaN(e))i=1;t("input",this).val(i).trigger("change"),t(this).attr("class","checked-"+i)})),t("body").on("click",".tpl-admin-question",(function(){t(".tpl-admin-subitem-desc",this).toggleClass("tpl-admin-hide")})),t("body").click((function(e){t(e.target).hasClass("tpl-admin-question")||t(".tpl-admin-subitem-desc").addClass("tpl-admin-hide")})),t("body").on("click","button.tpl-repeat-add",(function(e){e.preventDefault(),function(e,i){t("#tpl_repeater_bank .tpl-field[data-name='"+i+"']").clone().insertBefore(e.find(".tpl-repeat-button-container")),d(e),r(),_(),t(".tpl-dt-color",e).length>0&&t(".tpl-color-field",e).wpColorPicker(s);n(),t(".tpl-dt-font_awesome select",e).trigger("change"),o(),f()}(b.repeat_get_container(t(this)),t(this).attr("data-for"))})),t("body").on("click",".tpl-remover",(function(){var e,i;e=t(this),i=t(e).closest(".tpl-repeater"),1==confirm(TPL_Admin.remover_confirm_text)&&(t(e).closest(".tpl-field").remove(),d(i))})),t("body").on("click",".tpl-toggle-close",(function(){t(this).closest(".tpl-repeat").children(".tpl-field-inner").addClass("tpl-admin-hide"),t(this).closest(".tpl-repeat-header").addClass("tpl-repeat-header-closed"),t(this).attr("title",TPL_Admin.repeat_maximize),t(this).removeClass("tpl-toggle-close"),t(this).addClass("tpl-toggle-open")})),t("body").on("click",".tpl-toggle-open",(function(){t(this).closest(".tpl-repeat").children(".tpl-field-inner").removeClass("tpl-admin-hide"),t(this).closest(".tpl-repeat-header").removeClass("tpl-repeat-header-closed"),t(this).attr("title",TPL_Admin.repeat_minimize),t(this).addClass("tpl-toggle-close"),t(this).removeClass("tpl-toggle-open"),t(this).closest(".tpl-repeat").find(".tpl-color-field").focus()})),void 0!==t.ui.tabs)if(t("#tpl-settings-tabs").tabs(),"undefined"!==window.location.hash&&""!=window.location.hash)t("#tpl-settings-tabs").tabs("option","active",window.location.hash);else if("undefined"!=typeof Storage&&0!=t("#tpl-settings-tabs").length){var m=t("#tpl-settings-tabs").attr("data-store"),u=sessionStorage.getItem(m);void 0!==u&&t("#tpl-settings-tabs").tabs("option","active",u),t("#tpl-settings-tabs .nav-tab").click((function(){var e=t("#tpl-settings-tabs").attr("data-store"),i=t("#tpl-settings-tabs").tabs("option","active");sessionStorage.setItem(e,i)}))}function v(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}function g(){var e,i;return i=null,e=t("body").attr("class").split(" "),t(e).each((function(){"post-type-"!==this.substr(0,10)||(i=(i=this.split("post-type-"))[i.length-1])})),i}function _(){var e=window.location.href;t("body .tpl-field, body .tpl-meta-option").each((function(){if(b.is_section_primary())var i=v("page",e).replace("-","_"),a="tr";else i="",a=".tpl-meta-option";var s=t(this).attr("data-name"),n=t(this).attr("data-connected");if(t(this).hasClass("tpl-subitem"))var l=t(this).closest(".tpl-dt-combined").attr("data-instance");else l=t(this).attr("data-instance");if(t(this).hasClass("tpl-meta-option")&&(s=n),b.is_section_primary()&&!t(this).hasClass("tpl-subitem")&&t(this).closest(a).attr("data-connected",n),""==i&&(i=t(this).closest(".postbox").attr("id")),void 0!==TPL_Admin.Conditions&&void 0!==TPL_Admin.Conditions[s]){var o,r=Object.keys(TPL_Admin.Conditions[s]).length,d=[];for(o=0;o<r;o++)if(void 0!==TPL_Admin.Conditions[s][o]){var p=TPL_Admin.Conditions[s][o].type,c=TPL_Admin.Conditions[s][o].name,h=TPL_Admin.Conditions[s][o].relation,f=TPL_Admin.Conditions[s][o].value,m="",u="",_=[],y=[],w=[];if("option"==p){if(c.indexOf("/")>-1)if(_=c.split("/"),w=s.split("/"),"_THIS_"==_[0]){for(var C=0;C<w.length-1;C++){y[2*C]=w[C];for(var x="",A=0;A<=C;A++)x+=w[A],A<C&&(x+="/");y[2*C+1]=t(this).closest('.tpl-field[data-name="'+x+'"]').attr("data-instance")}y.push(_[_.length-1])}else y=_;else y[0]=c,y[1]=0;m=b.is_section_primary()?"#"+i:"#"+y[0];for(var k=0;k<y.length;k++)(b.is_section_primary()||k>0)&&(m+="\\["+y[k]+"\\]");u=t(m).val()}if("post"==p&&("type"==c&&(u=g()),"id"==c&&(u=v("post",e))),"page"==p&&"template"==c&&(u=t("#page_template").val()),"taxonomy"==p)if("post_format"==c)t("#post-formats-select input").each((function(){t(this).is(":checked")&&(u=t(this).attr("id").replace("post-format-",""))}));else{u=[];var T=0;t("#"+c+"checklist li").each((function(){T=t(this).attr("id").replace(c+"-",""),t("input",this).is(":checked")&&u.push(T)}))}switch(h){case"=":t.isArray(u)?t.inArray(f,u)>-1?d.push(!0):d.push(!1):u==f?d.push(!0):d.push(!1);break;case"!=":t.isArray(u)?t.inArray(f,u)<0?d.push(!0):d.push(!1):u!=f?d.push(!0):d.push(!1);break;case"<":u<f?d.push(!0):d.push(!1);break;case">":u>f?d.push(!0):d.push(!1)}}var P=!1,L="and";if(void 0!==TPL_Admin.Conditions[s].logic)L=TPL_Admin.Conditions[s].logic;"and"==L&&t.inArray(!1,d)<0&&(P=!0),"or"==L&&t.inArray(!0,d)>-1&&(P=!0),n=n.replace("/","/");var E="";t(this).is(".tpl-subitem")&&t(this).closest(".tpl-dt-combined").is(".tpl-repeat")&&(E='[data-instance="'+l+'"]'),void 0!==n&&(1==P?(t('[data-connected="'+n+'"]'+E).removeClass("tpl-admin-hide"),t(this).find("input, select, textarea").each((function(){t(this).attr("name",t(this).attr("id"))}))):(t('[data-connected="'+n+'"]'+E).addClass("tpl-admin-hide"),t(this).find("input, select, textarea").removeAttr("name"),t(this).closest(a).find(".tpl-field.tpl-dt-tinymce.tpl-admin-hide textarea").each((function(){var e=t(this).attr("id");tinymce.execCommand("mceRemoveEditor",!1,e)}))))}})),t(".postbox").each((function(){var e=[];t(".tpl-meta-option",this).each((function(){t(this).hasClass("tpl-admin-hide")?e.push(!0):e.push(!1)})),t.inArray(!0,e)>-1&&t.inArray(!1,e)<0?t(this).addClass("tpl-admin-hide"):t(this).removeClass("tpl-admin-hide")}))}t("body").on("change","select, input, textarea",(function(){_(),f()})),t("body").on("keyup","input, textarea",(function(){t(this).val().length<2&&_()})),setTimeout((function(){b.is_section_primary()&&t(".tpl-repeat-button-container").each((function(){t(this).closest("td").hasClass("tpl-repeater")||t(this).closest("td").addClass("tpl-repeater");var e=t(this).attr("data-connected");void 0!==e&&!1!==e&&t(this).closest("tr").attr("data-connected",t(this).attr("data-connected"))})),f(),_()}),100),t(window).load((function(){"undefined"!=typeof tinyMCE&&o()}));var b={is_section_primary:function(){var t=window.location.href;return t.indexOf("themes.php")>-1||t.indexOf("options-general.php")>-1||t.indexOf("admin.php")>-1},repeat_get_container:function(t){if(b.is_section_primary())var e=t.closest(".tpl-repeater");else e=t.closest(".tpl-meta-option-wrapper");return e}}}));