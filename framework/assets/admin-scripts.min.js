jQuery(document).ready(function(P){"use strict";function n(){P("body .tpl-dt-select").each(function(){P(this).has(".select2").length<1&&!P(this).hasClass("no-select2")&&!P(this).parents("#tpl_repeater_bank").length&&(P(this).is(".tpl-dt-font_awesome")?P(this).find("select").select2(i):P(this).find("select").select2(e))})}function t(t){return t.text}function s(){P("body .tpl-field.tpl-dt-tinymce").not(P("body .tpl-field.tpl-dt-tinymce.tpl-admin-hide")).each(function(){var t=P(this).find("textarea").attr("id");tinyMCE.execCommand("mceAddEditor",!1,t)}),P("body .tpl-field.tpl-dt-tinymce.tpl-admin-hide").each(function(){var t=P(this).find("textarea").attr("id");tinyMCE.execCommand("mceRemoveEditor",!1,t)})}function T(){var t=window.location.href;return-1<t.indexOf("themes.php")||-1<t.indexOf("options-general.php")||-1<t.indexOf("admin.php")?1:-1<t.indexOf("post.php")||-1<t.indexOf("post-new.php")?0:-1}function l(){P(".tpl-repeat").each(function(){P(this).parent().addClass("tpl-repeater")||P(this).parent().addClass("tpl-repeater")}),void 0!==P.ui.sortable&&P(".tpl-repeater").sortable({handle:".tpl-arranger",items:".tpl-repeat",update:function(t,e){o(P(this))},start:function(t,e){e.placeholder.height(e.item.height()),e.item.closest(".tpl-repeater").find(".tpl-field.tpl-dt-tinymce textarea").each(function(){var t=P(this).attr("id");tinyMCE.execCommand("mceRemoveEditor",!1,t)})},stop:function(t,e){s()}})}function o(t){var r=window.location.href,d=[];d[0]=0;t.find(".tpl-field").each(function(){var t=parseInt(P(this).attr("data-level")),a=P(this).attr("data-name").split("/");if(0<t)for(var e=0;e<t;e++){for(var i="",n=0;n<=e;n++)i+=a[n],n<e&&(i+="/");d[e]=parseInt(P(this).parents('.tpl-field[data-name="'+i+'"]').last().attr("data-instance"))}var s,l=parseInt(P(this).prev('.tpl-field[data-name="'+P(this).attr("data-name")+'"]').attr("data-instance"));if(s=l,!isNaN(parseFloat(s))&&isFinite(s)?d[t]=l+1:d[t]=0,P(this).attr("data-instance",d[t]),P(this).find(".tpl-header-title-instance").html("(#"+d[t]+")"),0==t)for(var o=1;o<d.length;o++)d[o]=0;P("input, select, textarea",this).each(function(){if(T())var t=P(this).closest(".tpl_settings_page_wrap").attr("data-name");else t=a[0];if(void 0!==t){for(var e=t,i=0;i<a.length;i++)i<a.length-1||1==a.length?(-1<r.indexOf("post.php")||-1<r.indexOf("post-new.php"))&&0==i?e+="["+d[i]+"]":e+="["+a[i]+"]["+d[i]+"]":P(this).closest(".tpl-field").hasClass("tpl-repeat")?e+="["+a[i]+"]["+d[i]+"]":e+="["+a[i]+"]";P(this).attr("name",e),P(this).attr("id",e),P(this).closest(".tpl-field").prevAll("label").attr("for",e)}})})}function a(t){return"tpl-dt-"+t.attr("data-type")}function r(t){var e="";if(void 0!==t.attr("data-preview-value"))e=t.attr("data-preview-value");else switch(t.prop("tagName").toLowerCase()){case"select":e=t.closest(".tpl-dt-select").is(".tpl-select-preview-key")?t.val():t.closest(".tpl-dt-select").find(".select2-selection__rendered").html();break;case"span":e=t.html();break;case"textarea":var i=t.val(),a=document.createElement("div");a.innerHTML=i,e=a.textContent||a.innerText||"";break;case"img":e=t.attr("src");break;default:e=t.val()}return e}function d(t){t=t.split("/");for(var e="",i=0;i<t.length-1;i++)e+=t[i],i<t.length-2&&(e+="/");return e}function p(){P(".tpl-repeat").each(function(){var s="",e="",l="",o=this;if(e=void 0!==TPL_Admin[P(this).attr("data-name")+"_preview-template"]?P(this).attr("data-name")+"_preview-template":a(P(this))+"_preview-template",P(this).is(".tpl-dt-combined"))if(void 0!==TPL_Admin[e]){var t=(s=TPL_Admin[e]).match(/\[.*?tpl-preview-\w*\]/g);P(".tpl-field",this).each(function(){var a=(l=P(this).attr("data-name")).split("/"),n=this;P.each(t,function(t,e){var i=e.split("/tpl-preview-");i[0]=a[0]+"/"+i[0].substring(1),i[1]=i[1].slice(0,-1),P("*[data-preview]",n).each(function(){i[0]==l&&P(this).attr("data-preview")==i[1]&&(s=-1<d(l).search("/")&&P('[data-name="'+d(l)+'"]').is(".tpl-repeat")&&P(this).closest('[data-name="'+d(l)+'"]').parent().find('[data-name="'+d(l)+'"]').length>parseInt(P(this).closest('[data-name="'+d(l)+'"]').attr("data-instance"))+1&&parseInt(P(n).attr("data-level"))<3&&P(o).is(".tpl-preview-multi")?s.replace(e,r(P(this)))+" / "+e:s.replace(e,r(P(this))))})})}),P.each(t,function(t,e){s=s.replace(e,"")})}else{var i=P(".tpl-field",this).length;P(".tpl-field",this).each(function(t){l=P(this).attr("data-name"),e=a(P(this))+"_preview-template",void 0!==TPL_Admin[e]?(s+=TPL_Admin[e],P("*[data-preview]",this).each(function(){var t=P(this).attr("data-preview");s=s.replace("[tpl-preview-"+t+"]",r(P(this)))})):P("*[data-preview]",this).each(function(){s+=r(P(this))}),t<i-1&&(s+=" / ")})}else void 0!==TPL_Admin[e]?(s=TPL_Admin[e],P("*[data-preview]",this).each(function(){var t=P(this).attr("data-preview");-1<s.indexOf("[tpl-preview-"+t+"]")&&(s=s.replace("[tpl-preview-"+t+"]",r(P(this))))})):P("*[data-preview]",this).each(function(){P(this).attr("data-preview");s+=r(P(this))});P(".tpl-header-title-preview",this).html(s)})}function L(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}function O(){var t,e;return e=null,t=P("body").attr("class").split(" "),P(t).each(function(){"post-type-"!==this.substr(0,10)||(e=(e=this.split("post-type-"))[e.length-1])}),e}function c(){var k=window.location.href;P("body .tpl-field, body .tpl-meta-option").each(function(){if(-1<k.indexOf("themes.php")||-1<k.indexOf("options-general.php")||-1<k.indexOf("admin.php"))var t=L("page",k).replace("-","_"),e="tr";if(-1<k.indexOf("post.php")||-1<k.indexOf("post-new.php"))t="",e=".tpl-meta-option";var i=P(this).attr("data-name"),a=P(this).attr("data-connected"),n=P(this).attr("data-instance");if(P(this).hasClass("tpl-meta-option")&&(i=a),T()&&!P(this).hasClass("tpl-subitem")&&P(this).closest(e).attr("data-connected",a),""==t&&(t=P(this).closest(".postbox").attr("id")),void 0!==TPL_Admin.Conditions&&void 0!==TPL_Admin.Conditions[i]){var s,l=Object.keys(TPL_Admin.Conditions[i]).length,o=[];for(s=0;s<l;s++)if(void 0!==TPL_Admin.Conditions[i][s]){var r=TPL_Admin.Conditions[i][s].type,d=TPL_Admin.Conditions[i][s].name,p=TPL_Admin.Conditions[i][s].relation,c=TPL_Admin.Conditions[i][s].value,h="",f="",m=[],u=[],v=[];if("option"==r){if(-1<d.indexOf("/"))if(m=d.split("/"),v=i.split("/"),"_THIS_"==m[0]){for(var g=0;g<v.length-1;g++){u[2*g]=v[g];for(var b="",w=0;w<=g;w++)b+=v[w],w<g&&(b+="/");u[2*g+1]=P(this).closest('.tpl-field[data-name="'+b+'"]').attr("data-instance")}u.push(m[m.length-1])}else u=m;else u[0]=d,u[1]=0;h=-1<k.indexOf("post.php")||-1<k.indexOf("post-new.php")?"#"+u[0]:"#"+t;for(var _=0;_<u.length;_++)-1<k.indexOf("post.php")||-1<k.indexOf("post-new.php")?0<_&&(h+="\\["+u[_]+"\\]"):h+="\\["+u[_]+"\\]";f=P(h).val()}if("post"==r&&("type"==d&&(f=O()),"id"==d&&(f=L("post",k))),"page"==r&&"template"==d&&(f=P("#page_template").val()),"taxonomy"==r)if("post_format"==d)P("#post-formats-select input").each(function(){P(this).is(":checked")&&(f=P(this).attr("id").replace("post-format-",""))});else{f=[];var y=0;P("#"+d+"checklist li").each(function(){y=P(this).attr("id").replace(d+"-",""),P("input",this).is(":checked")&&f.push(y)})}switch(p){case"=":P.isArray(f)?-1<P.inArray(c,f)?o.push(!0):o.push(!1):f==c?o.push(!0):o.push(!1);break;case"!=":P.isArray(f)?P.inArray(c,f)<0?o.push(!0):o.push(!1):f!=c?o.push(!0):o.push(!1);break;case"<":f<c?o.push(!0):o.push(!1);break;case">":c<f?o.push(!0):o.push(!1)}}var x=!1,C="and";if(void 0!==TPL_Admin.Conditions[i].logic)C=TPL_Admin.Conditions[i].logic;"and"==C&&P.inArray(!1,o)<0&&(x=!0),"or"==C&&-1<P.inArray(!0,o)&&(x=!0),a=a.replace("/","/");var A="";P(this).is(".tpl-subitem")&&P(this).closest(".tpl-dt-combined").is(".tpl-repeat")&&(A='[data-instance="'+n+'"]'),1==x?void 0!==a&&(P('[data-connected="'+a+'"]'+A).removeClass("tpl-admin-hide"),P(this).find("input, select, textarea").each(function(){P(this).attr("name",P(this).attr("id"))})):void 0!==a&&(P('[data-connected="'+a+'"]'+A).addClass("tpl-admin-hide"),P(this).find("input, select, textarea").removeAttr("name"),P(this).closest(e).find(".tpl-field.tpl-dt-tinymce.tpl-admin-hide textarea").each(function(){var t=P(this).attr("id");tinymce.execCommand("mceRemoveEditor",!1,t)}))}}),P(".postbox").each(function(){var t=[];P(".tpl-meta-option",this).each(function(){P(this).hasClass("tpl-admin-hide")?t.push(!0):t.push(!1)}),-1<P.inArray(!0,t)&&P.inArray(!1,t)<0?P(this).addClass("tpl-admin-hide"):P(this).removeClass("tpl-admin-hide")})}var h;TPL_Admin.basic_select2_settings={escapeMarkup:function(t){return t},width:"100%"};var e=P.extend({minimumResultsForSearch:10},TPL_Admin.basic_select2_settings),i=P.extend({templateSelection:t,templateResult:t,formatSelection:t,formatResult:t,minimumResultsForSearch:10},TPL_Admin.basic_select2_settings);l(),P("#wp-dummy_editor-wrap").remove(),P("body").on("click",".tpl-uploader .button, .tpl-uploader .tpl-uploaded-image, .tpl-img-placeholder",function(t){t.preventDefault();var e=P(this).parent().find(".tpl-uploaded-image"),i=e.closest(".tpl-field");(h=wp.media.frames.file_frame=wp.media({title:TPL_Admin.uploader_title,button:{text:TPL_Admin.uploader_button},multiple:!1})).on("select",function(){var t=h.state().get("selection").first().toJSON();void 0!==t.sizes.thumbnail?e.attr("src",t.sizes.thumbnail.url):e.attr("src",t.sizes.full.url),e.show(),i.find(".tpl-img_id").val(t.id).trigger("change"),i.find(".tpl-img-placeholder").hide(),i.find(".tpl-closer").show(),p()}),h.open()}),P("body").on("click",".tpl-uploader .tpl-closer",function(){var t=P(this).parent().find(".tpl-uploaded-image"),e=t.closest(".tpl-field");t.attr("src",""),e.find(".tpl-img-placeholder").show(),e.find(".tpl-uploaded-image").hide(),P(this).closest(".tpl-field").find(".tpl-img_id").val("").trigger("change"),P(this).hide(),p()});var f={width:258,change:function(t,e){P(this).val(P(this).wpColorPicker("color")),c(),p()}};if(P(".tpl-color-field").focus(function(){P(this).wpColorPicker(f)}),P(".tpl-color-field").each(function(){P(this).focus()}),P(".handlediv").click(function(){P(this).closest(".postbox").not("closed").find(".tpl-color-field").wpColorPicker(f)}),n(),P("body").on("change",".tpl-dt-font_awesome select",function(){var t=P(this).select2("data")[0].text.match(/ data-type="([^"]*)"/);P(this).closest(".tpl-field").find("[data-preview=3]").html(t[1])}),P("body").on("click",".tpl-editor-switch-buttons-wrap button",function(t){t.preventDefault();var e=P(this).closest(".tpl-field.tpl-dt-tinymce").find("textarea").attr("id");if(P(this).hasClass("tpl-editor-visual-button")){tinyMCE.execCommand("mceAddEditor",!1,e);e=P(this).closest(".tpl-field.tpl-dt-tinymce").find("textarea").css("visibility","hidden")}if(P(this).hasClass("tpl-editor-text-button")){tinyMCE.execCommand("mceRemoveEditor",!1,e);e=P(this).closest(".tpl-field.tpl-dt-tinymce").find("textarea").css("visibility","visible")}}),void 0!==P.datepicker&&P("body").on("focus",".tpl-field.tpl-dt-date input.tpl-date-field",function(){P(this).datepicker({dateFormat:"yy-mm-dd",firstDay:TPL_Admin.date_starts_with})}),P("body").on("click",".tpl-field.tpl-dt-boolean label",function(){var t=parseInt(P("input",this).val());if(1==t)var e=0;if(0==t||isNaN(t))e=1;P("input",this).val(e).trigger("change"),P(this).attr("class","checked-"+e)}),P("body").on("click","button.tpl-repeat-add",function(t){t.preventDefault();var e,i,a=function(t){var e=T();if(-1<e){if(1==e)var i=t.closest(".tpl-repeater");else 0==e&&(i=t.closest(".tpl-meta-option-wrapper"));return i}}(P(this));e=a,i=P(this).attr("data-for"),P("#tpl_repeater_bank .tpl-field[data-name='"+i+"']").clone().insertBefore(e.find(".tpl-repeat-button-container")),o(e),l(),c(),0<P(".tpl-dt-color",e).length&&P(".tpl-color-field",e).wpColorPicker(f),n(),P(".tpl-dt-font_awesome select",e).trigger("change"),s(),p()}),P("body").on("click",".tpl-remover",function(){var t,e;t=P(this),e=P(t).closest(".tpl-repeater"),1==confirm(TPL_Admin.remover_confirm_text)&&(P(t).closest(".tpl-field").remove(),o(e))}),P("body").on("click",".tpl-toggle-close",function(){P(this).closest(".tpl-repeat").children(".tpl-field-inner").addClass("tpl-admin-hide"),P(this).closest(".tpl-repeat-header").addClass("tpl-repeat-header-closed"),P(this).attr("title",TPL_Admin.Repeat_Maximize),P(this).removeClass("tpl-toggle-close"),P(this).addClass("tpl-toggle-open")}),P("body").on("click",".tpl-toggle-open",function(){P(this).closest(".tpl-repeat").children(".tpl-field-inner").removeClass("tpl-admin-hide"),P(this).closest(".tpl-repeat-header").removeClass("tpl-repeat-header-closed"),P(this).attr("title",TPL_Admin.Repeat_Minimize),P(this).addClass("tpl-toggle-close"),P(this).removeClass("tpl-toggle-open"),P(this).closest(".tpl-repeat").find(".tpl-color-field").focus()}),P(window).load(function(){T()&&P(".tpl-repeat-button-container").each(function(){P(this).closest("td").hasClass("tpl-repeater")||P(this).closest("td").addClass("tpl-repeater");var t=P(this).attr("data-connected");void 0!==t&&!1!==t&&P(this).closest("tr").attr("data-connected",P(this).attr("data-connected"))}),p(),c(),"undefined"!=typeof tinyMCE&&s()}),void 0!==P.ui.tabs&&(P("#tpl-settings-tabs").tabs(),"undefined"!=typeof Storage&&0!=P("#tpl-settings-tabs").length)){var m=P("#tpl-settings-tabs").attr("data-store"),u=sessionStorage.getItem(m);void 0!==u&&P("#tpl-settings-tabs").tabs("option","active",u),P("#tpl-settings-tabs .nav-tab").click(function(){var t=P("#tpl-settings-tabs").attr("data-store"),e=P("#tpl-settings-tabs").tabs("option","active");sessionStorage.setItem(t,e)})}P("body").on("change","select, input, textarea",function(){c(),p()}),P("body").on("keyup","input, textarea",function(){P(this).val().length<2&&c()})});